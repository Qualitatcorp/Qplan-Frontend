/*! qplan - v0.4.0 - 2017-06-16 for Ruben*/

"use strict";angular.module("ApiRest",[]).factory("WebApiConfig",function(){return{REST:{host:"/api",auth:"authentication",token:"token",refresh:"refresh",version:"v1",client_id:"qplan-admin",client_secret:"8XwxUrTssx"},get hostUrl(){return[this.REST.host,this.REST.version].join("/")},get authenticationUrl(){return[this.REST.host,this.REST.auth,this.REST.token].join("/")},get refreshUrl(){return[this.REST.host,this.REST.auth,this.REST.refresh].join("/")},resourceUrl:function(a){return[this.REST.host,this.REST.version,a].join("/")}}}),angular.module("ApiRest").factory("sessionServices",[function(){return{set token(a){console.log("Se almaceno token : "+a),sessionStorage.admin_access_token=a},get token(){return console.log("Token valido por : "+this.timeOut.getMinutes()+" minutos"),this.expire?null:sessionStorage.admin_access_token},set refresh(a){console.log("Se almaceno refresh : "+a),sessionStorage.admin_access_refresh=a},get refresh(){return sessionStorage.admin_access_refresh},set expire_in(a){console.log("La sesion dura : "+a/60+" minutos."),sessionStorage.admin_expire_in=Date.now()+1e3*a},set scope(a){console.log(a),sessionStorage.admin_scope=JSON.stringify(a)},get scope(){return JSON.parse(sessionStorage.admin_scope)},get expire(){return void 0===sessionStorage.admin_expire_in||Date.now()>Number(sessionStorage.admin_expire_in)},get timeOut(){return new Date(Number(sessionStorage.admin_expire_in)-Date.now())},logout:function(){delete sessionStorage.admin_access_token,delete sessionStorage.admin_access_refresh,delete sessionStorage.admin_expire_in,delete sessionStorage.admin_cliend_id}}}]),angular.module("ApiRest").service("authenticationServices",["WebApiConfig","$http","sessionServices",function(a,b,c){return{credential:function(c,d,e,f,g){var h={username:c,password:d,grant_type:g||"password",client_id:a.REST.client_id,client_secret:a.REST.client_secret,refresh:e||"false",identity:f||""};return b.post(a.authenticationUrl,h)},set identity(a){sessionStorage.setItem("identity",JSON.stringify(a.scope)),c.token=a.access_token},get identity(){sessionStorage.getItem("identity")},renovate:function(){if(c.refresh)return b.post(a.refreshUrl,{refresh:c.refresh});console.log("No se puede actualizar la session")}}}]),angular.module("ApiRest").factory("authInterceptor",["$q","sessionServices",function(a,b){return{request:function(c){return c.headers=c.headers||{},b.expire||(console.log("Etro a interceotar"),console.log(c),c.headers.Authorization="Bearer "+b.token),c||a.when(c)},response:function(b){return 401===b.status&&console.log(b),b||a.when(b)}}}]),angular.module("ApiRest").service("apiServices",["WebApiConfig","$http","$httpParamSerializer","sessionServices",function(a,b,c,d){return{_base:null,_primaryKey:"id",_params:{},request:function(a){return _.compact([_.compact(a).join("/"),c(this._params)]).join("?")},get:function(c){return this.credential(),b.get(this.request([a.resourceUrl(this._base),c]))},getAll:function(){return this.get()},search:function(){return this.credential(),b.get(a.resourceUrl(this._base)+"/search?"+c(this._params))},save:function(c){return this.credential(),c[this._primaryKey]?b.put([a.resourceUrl(this._base),c[this._primaryKey]].join("/"),c):b.post(a.resourceUrl(this._base),c)},remove:function(c){return this.credential(),b.delete([a.resourceUrl(this._base),c].join("/"))},params:function(a){return this._params={},angular.extend(this._params,a),this},fields:function(a){return angular.extend(this._params,{fields:a}),this},expand:function(a){return this._params={},angular.extend(this._params,{expand:a}),this},sort:function(a){return angular.extend(this._params,{sort:a}),this},page:function(a){return angular.extend(this._params,{page:a}),this},perPage:function(a){return angular.extend(this._params,{"per-page":a}),this},model:function(a,b){return angular.extend(this,{_base:a,_primaryKey:b||this._primaryKey,_params:{}}),angular.copy(this)},credential:function(){d.expire?delete b.defaults.headers.common.Authorization:b.defaults.headers.common.Authorization="Bearer "+d.token}}}]),function(a,b){function c(a){return"string"==typeof a?a.replace(/[^0-9kK]+/g,"").toUpperCase():""}function d(a,b){if(!(a=c(a)))return b;if(a.length<=1)return a;for(var d=a.slice(-4,-1)+"-"+a.substr(a.length-1),e=4;e<a.length;e+=3)d=a.slice(-3-e,-e)+"."+d;return d}function e(a){if("string"!=typeof a)return!1;for(var b=parseInt(a.slice(0,-1),10),c=0,d=1;b>0;)d=(d+b%10*(9-c++%6))%11,b=Math.floor(b/10);return(d>0?d-1+"":"K")===a.slice(-1)}function f(a){var b=function(b){var c=!(b.length>0)||e(b);return a.$setValidity("rut",c),c},f=function(a){return a=c(a),b(a)?a:null},g=function(a){return a=c(a),b(a),d(a)};a.$parsers.unshift(f),a.$formatters.unshift(g)}function g(a,b){a.$watch(function(){return b.$viewValue},function(){b.$setViewValue(d(b.$viewValue)),b.$render()})}function h(a,b){a.on("blur",function(){b.$setViewValue(d(b.$viewValue)),b.$render()})}a.module("rut",[]).directive("ngRut",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){switch(void 0===c.rutFormat&&(c.rutFormat="live"),f(d),c.rutFormat){case"live":g(a,d);break;case"blur":h(b,d)}}}}).filter("rut",function(){return d}).constant("RutHelper",{format:d,clean:c,validate:function(a){return e(c(a))}})}(angular),angular.module("admin",["ui.bootstrap","ngRoute","ngAnimate","ngSanitize","ngFileSaver","ui.bootstrap","toastr","ApiRest","User","Ot","Empresa","Worker","Evaluationmantenedor","Perfil","filters","ui.uploader","angularFileUpload","ui.select"]).config(["$routeProvider","uiSelectConfig",function(a,b){b.theme="bootstrap";var c={basePath:"views/",to:function(a){return this.basePath+a+".html"}};a.when("/",{redirectTo:"/login"}).when("/login",{templateUrl:c.to("login/form"),controller:"loginController"}).when("/inicio",{templateUrl:c.to("admin/inicio")}).when("/users/create",{templateUrl:c.to("users/create"),controller:"user.createController"}).when("/users/update/:id",{templateUrl:c.to("users/update"),controller:"user.updateController",resolve:{model:["apiServices","$route",function(a,b){return a.model("user").get(b.current.params.id)}]}}).when("/users/view/:id",{templateUrl:c.to("users/view"),controller:"user.viewController",resolve:{model:["apiServices","$route",function(a,b){return a.model("user").get(b.current.params.id)}]}}).when("/users/admin",{templateUrl:c.to("users/admin"),controller:"user.adminController",resolve:{users:["apiServices","$route",function(a){return a.model("user").get()}]}}).when("/users/role",{templateUrl:c.to("users/admin"),controller:"user.adminController",resolve:{users:["apiServices","$route",function(a){return a.model("user").get()}]}}).when("/users/resource",{templateUrl:c.to("users/resource/admin"),controller:"resource.adminController",resolve:{models:["apiServices","$route",function(a){return a.model("userresource").expand("children").get(1)}]}}).when("/users/authentication",{templateUrl:c.to("users/authentication/list"),controller:"authentication.adminCtrl",resolve:{models:["apiServices",function(a){return a.model("userauthentication").expand("user,client").sort("-expire").get()}]}}).when("/ot/create",{templateUrl:c.to("ot/create"),controller:"ot.createController"}).when("/ot/update/:id",{templateUrl:c.to("ot/update"),controller:"ot.updateController",resolve:{model:["otervices","$route",function(a,b){return a.get(b.current.params.id)}]}}).when("/ot/admin",{templateUrl:c.to("ot/admin"),controller:"ot.adminController",resolve:{list:["apiServices",function(a){return a.model("ordentrabajo").expand("solicitud,usuario,empresa,especialidad,perfil,mandante,countfic,counttra").fields("id,inicio,estado").getAll()}],services:"otServices"}}).when("/ot/:id/add",{templateUrl:c.to("ot/createTrabajador"),controller:"ot.createTrabajadorController"}).when("/ot/:id/fichas",{template:"Muestra la fichas"}).when("/ot/:id/summary",{templateUrl:c.to("ot/summary"),controller:"ot.summaryController",resolve:{ot:["apiServices","$route",function(a,b){return a.model("ordentrabajo").expand("solicitud,trabajador,empresa,mandante,usuario,perfil,fichanotas,modulos").get(b.current.params.id)}]}}).when("/ot/:id",{templateUrl:c.to("ot/view"),controller:"ot.viewController",resolve:{ot:["apiServices","$route",function(a,b){return a.model("ordentrabajo").expand("solicitud,trabajador,empresa,mandante,usuario,perfil").get(b.current.params.id)}]}}).when("/empresa",{templateUrl:c.to("empresa/admin"),controller:"empresa.adminController",resolve:{empresas:["apiServices",function(a){return a.model("empresa").getAll()}]}}).when("/empresa/create",{templateUrl:c.to("empresa/create"),controller:"empresa.createController"}).when("/empresa/edit/:id",{templateUrl:c.to("empresa/edit"),controller:"empresa.editController",resolve:{empresa:["apiServices","$route",function(a,b){return a.model("empresa").get(b.current.params.id)}]}}).when("/empresa/:id",{templateUrl:c.to("empresa/view"),controller:"empresa.viewController",resolve:{empresa:["apiServices","$route",function(a,b){return a.model("empresa").get(b.current.params.id)}]}}).when("/empresa/createclasificacion/:id",{templateUrl:c.to("empresa/createclasificacion"),controller:"empresa.createclasificacionController",resolve:{empresa:["apiServices","$route",function(a,b){return a.model("empresa").get(b.current.params.id)}]}}).when("/worker/admin",{templateUrl:c.to("trabajador/mantenedor/admin"),controller:"worker.adminController",resolve:{workers:["apiServices",function(a){return a.model("trabajador").getAll()}]}}).when("/worker/create",{templateUrl:c.to("trabajador/mantenedor/create"),controller:"worker.createController"}).when("/worker/edit/:id",{templateUrl:c.to("trabajador/mantenedor/edit"),controller:"worker.editController",resolve:{worker:["apiServices","$route",function(a,b){return a.model("trabajador").get(b.current.params.id)}]}}).when("/worker/:id",{templateUrl:c.to("trabajador/mantenedor/view"),controller:"worker.viewController",resolve:{worker:["apiServices","$route",function(a,b){return a.model("trabajador").get(b.current.params.id)}]}}).when("/evaluation/adminevaluation",{templateUrl:c.to("evaluation/adminevaluation"),controller:"evaluation.adminevaluationController",resolve:{evaluation:["apiServices","$route",function(a,b){return a.model("evaluacionteorica").get()}]}}).when("/evaluation/admincategoria",{templateUrl:c.to("evaluation/clasificacion/admincategoria"),controller:"evaluation.admincategoriaController",resolve:{categorias:["apiServices","$route",function(a,b){return a.model("clasificacioncategoria").get()}]}}).when("/evaluation/admintipo",{templateUrl:c.to("evaluation/admintipo"),controller:"evaluation.admintipoController",resolve:{tipos:["apiServices","$route",function(a,b){return a.model("evaluaciontipo").getAll()}]}}).when("/evaluation/adminclasificacion",{templateUrl:c.to("evaluation/clasificacion/adminclasificacion"),controller:"evaluation.adminclasificacionController",resolve:{clasificaciones:["apiServices","$route",function(a,b){return a.model("clasificacion").expand("categoria").get()}]}}).when("/evaluation/adminclasificacionperfil",{templateUrl:c.to("evaluation/clasificacion/adminclasificacionperfil"),controller:"evaluation.adminclasificacionperfilController",resolve:{clasificacionperfiles:["apiServices","$route",function(a,b){return a.model("clasificacionperfil").expand("clasificacion,perfil").get()}]}}).when("/evaluation/createevaluation",{templateUrl:c.to("evaluation/createevaluation"),controller:"evaluation.createevaluationController"}).when("/evaluation/createcategoria",{templateUrl:c.to("evaluation/clasificacion/createcategoria"),controller:"evaluation.createcategoriaController"}).when("/evaluation/createtipo",{templateUrl:c.to("evaluation/createtipo"),controller:"evaluation.createtipoController"}).when("/evaluation/createpregunta/:id",{templateUrl:c.to("evaluation/createpregunta"),controller:"evaluation.createpreguntaController"}).when("/evaluation/createclasificacion",{templateUrl:c.to("evaluation/clasificacion/createclasificacion"),controller:"evaluation.createclasificacionController"}).when("/evaluation/createclasificacionperfil",{templateUrl:c.to("evaluation/clasificacion/createclasificacionperfil"),controller:"evaluation.createclasificacionperfilController"}).when("/evaluation/editevaluation/:id",{templateUrl:c.to("evaluation/editevaluation"),controller:"evaluation.editevaluationController",resolve:{evaluation:["apiServices","$route",function(a,b){return a.model("evaluacionteorica").get(b.current.params.id)}]}}).when("/evaluation/editcategoria/:id",{templateUrl:c.to("evaluation/clasificacion/editcategoria"),controller:"evaluation.editcategoriaController",resolve:{categoria:["apiServices","$route",function(a,b){return a.model("clasificacioncategoria").get(b.current.params.id)}]}}).when("/evaluation/edittipo/:id",{templateUrl:c.to("evaluation/edittipo"),controller:"evaluation.edittipoController",resolve:{tipo:["apiServices","$route",function(a,b){return a.model("evaluaciontipo").get(b.current.params.id)}]}}).when("/evaluation/editpregunta/:id",{templateUrl:c.to("evaluation/editpregunta"),controller:"evaluation.editpreguntaController",resolve:{pregunta:["apiServices","$route",function(a,b){return a.model("evaluacionpregunta").expand("alternativas,recursos,rhs,sources").get(b.current.params.id)}]}}).when("/evaluation/editclasificacion/:id",{templateUrl:c.to("evaluation/clasificacion/editclasificacion"),controller:"evaluation.editclasificacionController",resolve:{clasificacion:["apiServices","$route",function(a,b){return a.model("clasificacion").expand("categoria").get(b.current.params.id)}]}}).when("/evaluation/editclasificacionperfil/:id",{templateUrl:c.to("evaluation/clasificacion/editclasificacionperfil"),controller:"evaluation.editclasificacionperfilController",resolve:{clasificacionperfil:["apiServices","$route",function(a,b){return a.model("clasificacionperfil").expand("clasificacion,perfil").get(b.current.params.id)}]}}).when("/evaluation/:id",{templateUrl:c.to("evaluation/viewevaluation"),controller:"evaluation.viewevaluationController",resolve:{evaluation:["apiServices","$route",function(a,b){return a.model("evaluacionteorica").expand("preguntas").get(b.current.params.id)}]}}).when("/evaluation/categoria/:id",{templateUrl:c.to("evaluation/clasificacion/viewcategoria"),controller:"evaluation.viewcategoriaController",resolve:{categoria:["apiServices","$route",function(a,b){return a.model("clasificacioncategoria").get(b.current.params.id)}]}}).when("/evaluation/tipo/:id",{templateUrl:c.to("evaluation/viewtipo"),controller:"evaluation.viewtipoController",resolve:{tipo:["apiServices","$route",function(a,b){return a.model("evaluaciontipo").get(b.current.params.id)}]}}).when("/evaluation/clasificacion/:id",{templateUrl:c.to("evaluation/clasificacion/viewclasificacion"),controller:"evaluation.viewclasificacionController",resolve:{clasificacion:["apiServices","$route",function(a,b){return a.model("clasificacion").expand("categoria").get(b.current.params.id)}]}}).when("/evaluation/clasificacionperfil/:id",{templateUrl:c.to("evaluation/clasificacion/viewclasificacionperfil"),controller:"evaluation.viewclasificacionperfilController",resolve:{clasificacionperfil:["apiServices","$route",function(a,b){return a.model("clasificacionperfil").expand("clasificacion,perfil").get(b.current.params.id)}]}}).when("/perfil/admin",{templateUrl:c.to("perfil/admin"),controller:"perfil.adminperfilController",resolve:{perfiles:["apiServices",function(a){return a.model("perfil").getAll()}]}}).when("/perfil/create",{templateUrl:c.to("perfil/create"),controller:"perfil.createperfilController"}).when("/perfil/edit/:id",{templateUrl:c.to("perfil/edit"),controller:"perfil.editperfilController",resolve:{perfil:["apiServices","$route",function(a,b){return a.model("perfil").get(b.current.params.id)}]}}).when("/perfil/:id",{templateUrl:c.to("perfil/view"),controller:"perfil.viewperfilController",resolve:{perfil:["apiServices","$route",function(a,b){return a.model("perfil").expand("modulos,evateorica").get(b.current.params.id)}]}}).otherwise({})}]),angular.module("filters",["ApiRest"]),angular.module("filters").filter("Calificacion",[function(){return function(a,b){var c=function(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d};if(a=a||"",b=b||"Sobre 7",""!==a)switch(b){case"Sobre 7":a=Math.round(10*c(a,0,1,1,7))/10;break;case"Sobre 100":a=Math.round(c(a,0,1,0,100))}return a}}]),angular.module("admin").controller("loginController",["$location","$scope","$route","authenticationServices","sessionServices","toastr",function(a,b,c,d,e,f){b.submit=function(){d.credential(b.login.username,b.login.password,"true","user").then(function(b){console.log(b),e.token=b.data.access_token,e.refresh=b.data.refresh,e.expire_in=b.data.expire_in,e.scope=b.data.scope,f.success("Ha ingresado exitosamente al sistema.","Exito"),a.path("inicio")},function(a){switch(a.status){case 401:f.warning("Usuario o contraseña incorrecta.","Atención");break;case 500:f.info("Servicio no disponible.","Información");default:f.error("Sin acceso a internet.","Información"),console.log(a)}})}}]),angular.module("admin").controller("navbarController",["$scope","toastr","$location","sessionServices","apiServices","$timeout","$uibModal","$route",function(a,b,c,d,e,f,g,h){a.$on("$routeChangeError",function(a,c,d,e){switch(e.status){case 401:b.error("Tus credenciales han expirado","Error"),j()}}),a.menu=[];var i=function(){d.expire?(a.menu=[],f(i,1e3)):(0==a.menu.length&&(a.menu=[{name:"Administración",items:[{label:"Sistema",items:[{label:"Usuarios",href:"users/admin"},{label:"Roles",href:"users/role"},{label:"Recursos",href:"users/resource"},{label:"Clientes",href:"users/clients"},{label:"Accesos",href:"users/authentication"}]}]},{name:"Empresa",items:[{label:"Empresa",items:[{label:"Crear",href:"empresa/create"},{label:"Administrar",href:"empresa"}]}]},{name:"Trabajador",items:[{label:"Trabajadores",items:[{label:"Crear",href:"worker/create"},{label:"Administrar",href:"worker/admin"}]}]},{name:"Orden de Servicio",items:[{label:"Orden de Servicio",items:[{label:"Crear",href:"ot/create"},{label:"Administrar",href:"ot/admin"}]}]},{name:"Evaluación",items:[{label:"Evaluación",items:[{label:"Crear Evaluación",href:"evaluation/createevaluation"},{label:"Administrar Evaluación",href:"evaluation/adminevaluation"},{label:"Crear Tipo",href:"evaluation/createtipo"},{label:"Administrar Tipo",href:"evaluation/admintipo"}]}]},{name:"Perfil",items:[{label:"Perfil",items:[{label:"Crear",href:"perfil/create"},{label:"Administrar",href:"perfil/admin"}]},{label:"Clasificación",items:[{label:"Crear Categoría",href:"evaluation/createcategoria"},{label:"Administrar Categoría",href:"evaluation/admincategoria"},{label:"Crear Clasificación",href:"evaluation/createclasificacion"},{label:"Administrar Clasificación",href:"evaluation/adminclasificacion"}]}]}]),d.timeOut.getMinutes()<10?k():f(i,6e4))},j=function(){g.open({animation:!0,templateUrl:"views/login/modalForm.html",size:"sm",controller:["$scope","sessionServices","authenticationServices","$uibModalInstance","toastr","$route","$location",function(a,b,c,d,e,f,g){a.model={username:"",password:""},a.login=function(){c.credential(a.model.username,a.model.password,"true").then(function(a){b.token=a.data.access_token,b.refresh=a.data.refresh,b.expire_in=a.data.expire_in,f.reload(),d.close()},function(a){switch(a.status){case 401:e.warning("Usuario o contraseña incorrecta.","Atención");break;case 500:e.info("Servicio no disponible.","Información");default:e.error("Sin acceso a internet.","Información")}})}}]})},k=function(){g.open({animation:!0,templateUrl:"views/login/refresh.html",size:"sm",controller:["$scope","sessionServices","authenticationServices","$uibModalInstance","toastr","$route","$timeout","$location",function(a,b,c,d,e,f,g,h){a.time,a.updateTime=function(){a.time=b.timeOut,b.timeOut.getMinutes()<10&&!b.expire&&g(a.updateTime,1e3),b.expire&&(b.logout(),h.path("/welcome"))},g(a.updateTime),a.refresh=function(){c.renovate().then(function(a){console.log(a),b.refresh=a.data.refresh,b.expire_in=a.data.expire_in,e.success("Actualizando sistema.","Atención"),d.close()},function(a){e.error("El sistema no se encuentra disponible en este momento","Atención")})},a.close=function(){d.close()}}]})};f(i),a.session=d.expire,a.logout=function(){d.logout(),sessionStorage.clear(),c.path("inicio"),i(),console.log("Session limpiada"),h.reload()}}]),angular.module("admin").controller("inicioController",["$scope","$route","toastr",function(a,b,c){}]),angular.module("User",["ngAnimate","ui.bootstrap","mwl.confirm","toastr","ApiRest","rut"]),angular.module("User").controller("user.adminController",["$scope","toastr","$location","apiServices","users",function(a,b,c,d,e){a.users=e.data;var f=e.headers("x-pagination-total-count");a.totalItems=parseInt(f),a.currentPage=1,a.pageItems=20,a.setPage=function(b){a.currentPage=b},a.pageChanged=function(b){d.model("user").page(b).get().then(function(b){a.users=b.data})},a.remove=function(c){userServices.remove(a.users[c].id).then(function(d){a.users.splice(c,1),b.success("Se ha eliminado con exito.","Exito")},function(a){b.error("Codigo : "+a.status,"Error")})}}]),angular.module("User").controller("user.createController",["$scope","toastr","$location","userServices",function(a,b,c,d){a.back=function(){window.history.back()},a.save=function(a){d.save(a).then(function(a){b.success("Se ha creado un nuevo usuario.","Exito"),c.path("users/admin")},function(a){switch(a.status){case 422:a.data.forEach(function(a){b.error(a.message,"¡Error!")})}console.warn(a)})}}]),angular.module("User").controller("user.updateController",["$scope","toastr","$location","userServices","model",function(a,b,c,d,e){a.model=e.data,a.model.nacimiento&&(a.model.nacimiento=new Date(a.model.nacimiento)),a.back=function(){window.history.back()},a.save=function(a){d.save(a).then(function(a){b.success("Se han guardado los cambios.","Exito"),c.path("users/admin")},function(a){switch(a.status){case 422:a.data.forEach(function(a){b.error(a.message,"¡Error!")})}})}}]),angular.module("User").controller("user.viewController",["$scope","toastr","$location","userServices","model",function(a,b,c,d,e){a.model=e.data,a.model.nacimiento&&(a.model.nacimiento=new Date(a.model.nacimiento)),a.back=function(){window.history.back()}}]),angular.module("User").controller("resource.adminController",["$scope","toastr","$location","apiServices","models",function(a,b,c,d,e){a.group=function(a,b){var c=_(a).map(function(a){return _(["id","active","modulo","controller","action"]).object(_([a.id,!1]).union(a.resource.split("_")))}),d=[];return _(_(c).pluck("modulo")).uniq().forEach(function(a){var b=[];_(_(_(c).where({modulo:a})).pluck("controller")).uniq().forEach(function(d){b.push({name:d,actions:_(c).where({modulo:a,controller:d})})}),d.push({name:a,controller:b})}),d}(e.data.children),a.models=e.data,a.actions=function(a){console.log(a)}}]),angular.module("User").controller("authentication.adminCtrl",["$scope","models","apiServices",function(a,b,c){a.now=Date.now();var d=c.model("userauthentication").expand("user,client").sort("-expire");a.models=b.data,a.page={total:b.headers("x-pagination-total-count"),current:b.headers("x-pagination-current-page"),perPage:b.headers("x-pagination-per-page"),change:function(){d.page(this.current).perPage(this.perPage).get().then(function(b){a.models=b.data,console.log(b)})}}}]),angular.module("Ot",["ngAnimate","ui.bootstrap","mwl.confirm","angular-js-xlsx","toastr","ApiRest","rut"]),angular.module("Ot").controller("ot.adminController",["$scope","toastr","$location","services","list",function(a,b,c,d,e){a.list=e.data}]),angular.module("Ot").controller("ot.createController",["$scope","toastr","$location","apiServices",function(a,b,c,d){a.model={estado:"ABIERTO"},solicitudServices=d.model("ordentrabajosolicitud"),solicitudServices.expand("empresa").getAll().then(function(b){a.solicitud=b.data,console.log(b)}),especialidadServices=d.model("especialidad"),especialidadServices.getAll().then(function(b){a.especialidad=b.data,console.log(b)}),perfilServices=d.model("perfil"),perfilServices.getAll().then(function(b){a.perfil=b.data,console.log(b)}),empresaServices=d.model("empresa"),empresaServices.getAll().then(function(b){a.empresas=b.data,console.log(b)}),otServices=d.model("ordentrabajo"),a.back=function(){window.history.back()},a.save=function(){console.log(a.model),otServices.save(a.model).then(function(a){b.success("Se ha creado una nueva ot.","Exito"),c.path("/ot/"+a.data.id)},function(a){switch(a.status){case 422:a.data.forEach(function(a){b.error(a.message,"¡Error!")})}console.warn(a)})}}]),angular.module("Ot").controller("ot.updateController",["$scope","toastr","$location","services","model",function(a,b,c,d,e){a.model=e.data,a.model.nacimiento&&(a.model.nacimiento=new Date(a.model.nacimiento)),a.back=function(){window.history.back()},a.save=function(a){d.save(a).then(function(a){b.success("Se han guardado los cambios.","Exito"),c.path("users/admin")},function(a){switch(a.status){case 422:a.data.forEach(function(a){b.error(a.message,"¡Error!")})}})}}]),angular.module("Ot").controller("ot.viewController",["$scope","toastr","$location","ot","apiServices","FileSaver","Blob","RutHelper",function(a,b,c,d,e,f,g,h){function i(b){k.save({ot_id:d.data.id,tra_id:b.id}).then(function(c){a.model.trabajador.push(b)},function(a){console.warn(a)})}var j=e.model("trabajador"),k=e.model("ordentrabajotrabajador");a.model=d.data,a.rmTrabajador=function(c){var e=a.model.trabajador[c];k.params({ot_id:d.data.id,tra_id:e.id}).search().then(function(d){k.remove(d.data[0].id).then(function(d){a.model.trabajador.splice(c,1),b.success("Eliminado con exito","Éxito")},function(a){b.error("Error al eliminar.","Error"),console.log(a)})})},a.read=function(c){var d=XLSX.utils.sheet_to_json(c.Sheets[c.SheetNames[0]]),e={};d.forEach(function(c){if(void 0===c.rut)e.columna_rut=!0;else if(h.validate(c.rut)){c.rut=h.format(c.rut);var d=_.findWhere(a.model.trabajador,{rut:c.rut});d?(d.nombre=c.nombre||d.nombre,d.paterno=c.paterno||d.paterno,d.materno=c.materno||d.materno,j.save(d).then(function(a){console.log("guardo el trabajador con exito")},function(a){console.warn(a)})):j.search({rut:c.rut}).then(function(a){console.log("Lo encontro"),a.data[0].nombre=c.nombre||a.data[0].nombre,a.data[0].paterno=c.paterno||a.data[0].paterno,a.data[0].materno=c.materno||a.data[0].materno,j.save(a.data[0]).then(function(a){i(a.data)})},function(a){console.log("No encontro trabajador"),j.save(c).then(function(a){console.log("guardo"),i(a.data)})})}else b.error("Atencion el RUT : "+h.format(c.rut)+", no es válido.","¡Atención!")}),e.columna_rut&&b.error("No existe la columna rut en el xls","¡Atención!")},a.error=function(a){},a.downloadPlantilla=function(){var b={toSql:function(a,b){return[b].concat(_.map(a,function(a){var c=[];return b.forEach(function(b){c.push(a[b])}),c}))},s2ab:function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d!=a.length;++d)c[d]=255&a.charCodeAt(d);return b}},c=XLSX.utils.aoa_to_sheet(b.toSql(a.model.trabajador,["rut","nombre","paterno","materno"])),d={SheetNames:["trabajadores"],Sheets:{trabajadores:c}},e={bookType:"xlsx",bookSST:!1,type:"binary"},h=XLSX.write(d,e);f.saveAs(new g([b.s2ab(h)],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),"trabajador.xlsx")}}]),angular.module("Ot").controller("ot.createTrabajadorController",["$scope","toastr","apiServices","RutHelper","$routeParams",function(a,b,c,d,e){a.model={rut:"",nombre:"",paterno:"",materno:""},a.clear=function(){a.model={rut:"",nombre:"",paterno:"",materno:""}};var f={Ott:c.model("ordentrabajotrabajador"),Trabajador:c.model("trabajador")};a.exists=function(b){b&&(f.Trabajador.params({rut:d.format(b)}).search().then(function(b){a.model=b.data[0]},function(a){console.warn(a)}),console.log(d.format(b)))},a.save=function(a){a.rut=d.format(a.rut),f.Trabajador.save(a).then(function(a){f.Ott.save({ot_id:e.id,tra_id:a.data.id}).then(function(a){window.history.back()},function(a){b.info("El trabajador ya esta asignado","Información")})},function(a){a.data.forEach(function(a){b.error("Error "+a,"Error")})})}}]),angular.module("Ot").controller("ot.summaryController",["$scope","toastr","$timeout","ot","$uibModal","apiServices",function(a,b,c,d,e,f){f.model("ficha");a.tercero=_(d.data.modulos).filter(function(a){return-1!=a.evaluacion.search("TERCERO")}),d.data.fichanotas&&d.data.fichanotas.forEach(function(a){angular.extend(_(d.data.fichanotas).findWhere({id:a.id}),{trabajador:_(d.data.trabajador).findWhere({id:a.tra_id})})}),d.data.trabajador&&d.data.trabajador.forEach(function(a){_(d.data.fichanotas).findWhere({tra_id:a.id})||f.model("ficha").save({ot_id:d.data.id,tra_id:a.id,proceso:"PENDIENTE"}).then(function(a){d.data.fichanotas=a.data})}),a.model=d.data,a.addPractica=function(a){e.open({animation:!0,templateUrl:"views/ot/practica/modal.html",size:"md",controller:["$scope","apiServices","$uibModalInstance","toastr","$route","ficha","modulos",function(a,b,c,d,e,f,g){var h=b.model("fichapractica"),i=b.model("ficha"),j=function(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d},k=[];g.forEach(function(a){var b=_(f.data.ficpracticas).findWhere({mod_id:a.id});b?k.push({modulo:a,ficp:b}):k.push({modulo:a,ficp:{mod_id:a.id,fic_id:f.data.id}})}),k.forEach(function(a){a.ficp.nota&&(a.notaTemp=Math.round(10*j(a.ficp.nota,0,1,1,7))/10)}),a.modulos=k,a.save=function(){var b=!1;angular.forEach(a.modulos,function(a){void 0!=a.notaTemp?(a.ficp.nota=j(a.notaTemp,1,7,0,1),h.save(a.ficp)):b=!0}),b?d.warning("Se han guardado los cambios,pero no se ha ingresado todas las nota.","Atención"):(f.data.proceso?f.data.proceso+=",FINALIZADO PRACTICA":f.data.proceso="FINALIZADO PRACTICA",i.save(f.data),d.success("Se han guardado con exito la evaluación.","Atención")),c.close(),e.reload()}}],resolve:{modulos:function(){return _(d.data.modulos).filter(function(a){return-1!=a.evaluacion.search("PRACTICA")})},ficha:f.model("ficha").expand("ficpracticas").get(a.id)}})}}]),angular.module("Worker",["ngAnimate","toastr","ApiRest","ui.bootstrap"]),angular.module("Worker").controller("worker.adminController",["workers","$scope","apiServices",function(a,b,c){b.workers=a.data;var d=a.headers("x-pagination-total-count");b.totalItems=parseInt(d),b.currentPage=1,b.pageItems=20,b.setPage=function(a){b.currentPage=a},b.pageChanged=function(a){c.model("trabajador").page(a).get().then(function(a){b.workers=a.data})},b.remove=function(a){c.model("trabajador").remove(b.workers[a].id).then(function(c){b.workers.splice(a,1),toastr.success("Se ha eliminado con exito.","Exito")},function(a){toastr.error("Codigo : "+a.status,"Error")})}}]),angular.module("Worker").controller("worker.createController",["$scope","paisServices","trabajadorServices","$location",function(a,b,c,d){function e(a){var b=a.date;return"day"===a.mode&&(0===b.getDay()||6===b.getDay())}function f(b){var c=b.date;if("day"===b.mode)for(var d=new Date(c).setHours(0,0,0,0),e=0;e<a.events.length;e++){var f=new Date(a.events[e].date).setHours(0,0,0,0);if(d===f)return a.events[e].status}return""}a.worker={},a.select={nivel:["Basica completa","Media incompleta","Media completa","Tecnica","Técnico en nivel superior incompleta","Técnico en nivel superior","Profesional incompleta","Profesional"],licencia:["A1","A2","A3","A4","A5","B","C","D","E","F"],civil:["SOLTERO/A","CASADO/A","DIVORCIADO/A","SEPARADO","CONVIVIENTE"],talla:["XXS","XS","S","M","L","XL","XXL","XXXL"],afp:["AFP Cuprum","AFP Habitat","AFP PlanVital","ProVida AFP","AFP Capital","AFP Modelo"],salud:["FONASA","BANMEDICA","CONSALUD","CRUZ BLANCA","ING","CAPREDENA","DIPRECA","MASVIDA","SIN PREVISIÓN"],hijos:[0,1,2,3,4,5,6,7,8,9],antiguedad:[0,1,2,3,4,5,6,7,8,9]},a.interface={set pais(b){a.worker.pais=b,angular.isObject(a.worker.pais)&&(a.worker.pais_id=a.worker.pais.id)},get pais(){return angular.isObject(a.worker.pais)?a.worker.pais.nombre:a.worker.pais}},
a.getPaises=function(a){return b.search({nombre:a}).then(function(a){return a.data})},a.today=function(){a.worker.nacimiento=new Date},a.today(),a.clear=function(){a.worker.nacimiento=null},a.inlineOptions={customClass:f,minDate:new Date,showWeeks:!0},a.dateOptions={dateDisabled:e,formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1},a.toggleMin=function(){a.inlineOptions.minDate=a.inlineOptions.minDate?null:new Date,a.dateOptions.minDate=a.inlineOptions.minDate},a.toggleMin(),a.open1=function(){a.popup1.opened=!0},a.open2=function(){a.popup2.opened=!0},a.setDate=function(b,c,d){a.worker.nacimiento=new Date(b,c,d)},a.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],a.format=a.formats[0],a.altInputFormats=["M!/d!/yyyy"],a.popup1={opened:!1},a.popup2={opened:!1};var g=new Date;g.setDate(g.getDate()+1);var h=new Date;h.setDate(g.getDate()+1),a.events=[{date:g,status:"full"},{date:h,status:"partially"}],a.save=function(){c.save(a.worker).then(function(a){console.log(a),d.path("worker/admin")},function(a){console.warn(a)})}}]),angular.module("Worker").controller("worker.editController",["$scope","worker","trabajadorServices","comunaServices","paisServices","$location",function(a,b,c,d,e,f){function g(a){var b=a.date;return"day"===a.mode&&(0===b.getDay()||6===b.getDay())}function h(b){var c=b.date;if("day"===b.mode)for(var d=new Date(c).setHours(0,0,0,0),e=0;e<a.events.length;e++){var f=new Date(a.events[e].date).setHours(0,0,0,0);if(d===f)return a.events[e].status}return""}a.worker=b.data,a.worker.nacimiento=new Date(a.worker.nacimiento),console.log(b.data),a.select={nivel:["Basica completa","Media incompleta","Media completa","Tecnica","Técnico en nivel superior incompleta","Técnico en nivel superior","Profesional incompleta","Profesional"],licencia:["A1","A2","A3","A4","A5","B","C","D","E","F"],civil:["SOLTERO/A","CASADO/A","DIVORCIADO/A","SEPARADO","CONVIVIENTE"],talla:["XXS","XS","S","M","L","XL","XXL","XXXL"],afp:["AFP Cuprum","AFP Habitat","AFP PlanVital","ProVida AFP","AFP Capital","AFP Modelo"],salud:["FONASA","BANMEDICA","CONSALUD","CRUZ BLANCA","ING","CAPREDENA","DIPRECA","MASVIDA","SIN PREVISIÓN"],hijos:[0,1,2,3,4,5,6,7,8,9],antiguedad:[0,1,2,3,4,5,6,7,8,9]},a.interface={set pais(b){a.worker.pais=b,angular.isObject(a.worker.pais)&&(a.worker.pais_id=a.worker.pais.id)},get pais(){return angular.isObject(a.worker.pais)?a.worker.pais.nombre:a.worker.pais}},a.getPaises=function(a){return e.search({nombre:a}).then(function(a){return a.data})},a.clear=function(){a.worker.nacimiento=null},a.inlineOptions={customClass:h,minDate:new Date,showWeeks:!0},a.dateOptions={dateDisabled:g,formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1},a.toggleMin=function(){a.inlineOptions.minDate=a.inlineOptions.minDate?null:new Date,a.dateOptions.minDate=a.inlineOptions.minDate},a.toggleMin(),a.open1=function(){a.popup1.opened=!0},a.open2=function(){a.popup2.opened=!0},a.setDate=function(b,c,d){a.worker.nacimiento=new Date(b,c,d)},a.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],a.format=a.formats[0],a.altInputFormats=["M!/d!/yyyy"],a.popup1={opened:!1},a.popup2={opened:!1};var i=new Date;i.setDate(i.getDate()+1);var j=new Date;j.setDate(i.getDate()+1),a.events=[{date:i,status:"full"},{date:j,status:"partially"}],a.save=function(){c.save(a.worker).then(function(a){console.log(a),f.path("worker/admin")},function(a){console.warn(a)})}}]),angular.module("Worker").controller("worker.viewController",["toastr","apiServices","$scope","worker","trabajadorServices","comunaServices","paisServices","$location",function(a,b,c,d,e,f,g,h){c.back=function(){window.history.back()},c.worker=d.data,c.remove=function(c){b.model("trabajador").remove(c).then(function(b){a.success("Se ha eliminado con exito.","Exito"),window.history.back()},function(b){a.error("Codigo : "+b.status,"Error")})}}]),angular.module("Empresa",["ngAnimate","toastr","ApiRest","ui.bootstrap"]),angular.module("Empresa").controller("empresa.adminController",["empresas","$scope","apiServices","toastr",function(a,b,c,d){b.empresas=a.data;var e=a.headers("x-pagination-total-count");b.totalItems=parseInt(e),b.currentPage=1,b.pageItems=20,b.setPage=function(a){b.currentPage=a},b.pageChanged=function(a){c.model("empresa").page(a).get().then(function(a){b.empresas=a.data})},b.remove=function(a){c.model("empresa").remove(b.empresas[a].id).then(function(c){b.empresas.splice(a,1),d.success("Se ha eliminado con exito.","Exito")},function(a){d.error("Codigo : "+a.status,"Error")})}}]),angular.module("Empresa").controller("empresa.createController",["$scope","apiServices","$location","toastr",function(a,b,c,d){a.empresa={},a.select={habilitado:["SI","NO"]},a.interface={set comuna(b){a.empresa.comuna=b,angular.isObject(a.empresa.comuna)&&(a.empresa.com_id=a.empresa.comuna.com_id)},get comuna(){return angular.isObject(a.empresa.comuna)?a.empresa.comuna.nombre:a.empresa.comuna},set pais(b){a.empresa.pais=b,angular.isObject(a.empresa.pais)&&(a.empresa.pais_id=a.empresa.pais.id)},get pais(){return angular.isObject(a.empresa.pais)?a.empresa.pais.nombre:a.empresa.pais}},a.getPaises=function(a){return b.model("pais").params({nombre:a}).search().then(function(a){return a.data})},a.getComunas=function(a){return b.model("comuna").params({nombre:a}).search().then(function(a){return a.data})},a.save=function(){b.model("empresa").save(a.empresa).then(function(a){c.path("empresa"),d.success("Se ha registrado la empresa con exito.","Exito")},function(a){d.error("Codigo : "+a.status,"Error")})}}]),angular.module("Empresa").controller("empresa.editController",["$scope","empresa","empresaServices","comunaServices","paisServices","$location",function(a,b,c,d,e,f){a.empresa=b.data,a.select={habilitado:["SI","NO"]},d.get(a.empresa.com_id).then(function(b){a.interface.comuna=b.data}),e.get(a.empresa.pais_id).then(function(b){a.interface.pais=b.data}),a.getPaises=function(a){return e.search({nombre:a}).then(function(a){return a.data})},a.getComunas=function(a){return d.search({nombre:a}).then(function(a){return a.data})},a.interface={set comuna(b){a.empresa.comuna=b,angular.isObject(a.empresa.comuna)&&(a.empresa.com_id=a.empresa.comuna.com_id)},get comuna(){return angular.isObject(a.empresa.comuna)?a.empresa.comuna.nombre:a.empresa.comuna},set pais(b){a.empresa.pais=b,angular.isObject(a.empresa.pais)&&(a.empresa.pais_id=a.empresa.pais.id)},get pais(){return angular.isObject(a.empresa.pais)?a.empresa.pais.nombre:a.empresa.pais}},a.save=function(){c.save(a.empresa).then(function(a){console.log(a),f.path("empresa")},function(a){console.warn(a)})}}]),angular.module("Empresa").controller("empresa.viewController",["apiServices","$scope","empresa","empresaServices","comunaServices","paisServices","$location","toastr",function(a,b,c,d,e,f,g,h){b.empresa=c.data;var i=b.empresa.creada;b.empresa.creada=i.split(" ")[0],e.get(b.empresa.com_id).then(function(a){b.empresa.comuna=a.data}),f.get(b.empresa.pais_id).then(function(a){b.empresa.pais=a.data}),b.remove=function(b){a.model("empresa").remove(b).then(function(a){h.success("Se ha eliminado con exito.","Exito"),g.path("empresa")},function(a){h.error("Codigo : "+a.status,"Error")})}}]),angular.module("Evaluationmantenedor",["ngAnimate","toastr","ApiRest","ui.bootstrap"]),angular.module("Evaluationmantenedor").controller("evaluation.adminevaluationController",["evaluation","$scope","apiServices","toastr",function(a,b,c,d){b.evaluations=a.data;var e=c.model("evaluacionteorica");b.totalItems=parseInt(a.headers("x-pagination-total-count")),b.currentPage=1,b.pageItems=20,b.searchItems=function(a){a?e.params({nombre:a}).search().then(function(a){b.evaluations=a.data,b.totalItems=parseInt(a.headers("x-pagination-total-count")),console.log(a.headers()),b.currentPage=1,b.pageItems=20},function(a){switch(a.status){case 404:console.log("¡Error!")}}):e.get().then(function(a){b.evaluations=a.data,b.totalItems=parseInt(a.headers("x-pagination-total-count")),b.currentPage=1,b.pageItems=20})},b.pageChanged=function(a,c){c?e.page(a-1).params({nombre:c}).search().then(function(c){b.evaluations=c.data,b.totalItems=parseInt(c.headers("x-pagination-total-count")),b.currentPage=a,b.pageItems=20},function(c){404==c.status&&(b.evaluations={},b.totalItems=0,b.currentPage=a,b.pageItems=20)}):e.page(a).get().then(function(c){b.evaluations=c.data,b.totalItems=parseInt(c.headers("x-pagination-total-count")),b.currentPage=a,b.pageItems=20})},b.remove=function(a){c.model("evaluacionteorica").remove(b.evaluations[a].id).then(function(c){b.evaluations.splice(a,1),d.success("Se ha eliminado con exito.","Exito")},function(a){d.error("Codigo : "+a.status,"Error")})}}]),angular.module("Evaluationmantenedor").controller("evaluation.createevaluationController",["$scope","apiServices","$location",function(a,b,c){a.evaluation={},a.interface={set tipo(b){a.evaluation.tipo=b,angular.isObject(a.evaluation.tipo)&&(a.evaluation.tev_id=a.evaluation.tipo.id)},get tipo(){return angular.isObject(a.evaluation.tipo)?a.evaluation.tipo.nombre:a.evaluation.tipo}},a.getTipos=function(a){return b.model("evaluaciontipo").search({nombre:a}).then(function(a){return a.data})},a.save=function(){b.model("evaluacionteorica").save(a.evaluation).then(function(a){console.log(a),c.path("evaluation/adminevaluation")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.editevaluationController",["$scope","evaluation","apiServices","$location",function(a,b,c,d){a.evaluation=b.data,c.model("evaluaciontipo").get(a.evaluation.tev_id).then(function(b){a.interface.tipo=b.data}),a.interface={set tipo(b){a.evaluation.tipo=b,angular.isObject(a.evaluation.tipo)&&(a.evaluation.tev_id=a.evaluation.tipo.id)},get tipo(){return angular.isObject(a.evaluation.tipo)?a.evaluation.tipo.nombre:a.evaluation.tipo}},a.getTipos=function(a){return c.model("evaluaciontipo").search({nombre:a}).then(function(a){return a.data})},a.save=function(){c.model("evaluacionteorica").save(a.evaluation).then(function(a){console.log(a),d.path("evaluation/adminevaluation")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.viewevaluationController",["$scope","toastr","evaluation","apiServices","$location",function(a,b,c,d,e){a.evaluation=c.data,d.model("evaluaciontipo").get(a.evaluation.tev_id).then(function(b){a.interface.tipo=b.data}),a.interface={set tipo(b){a.evaluation.tipo=b,angular.isObject(a.evaluation.tipo)&&(a.evaluation.tev_id=a.evaluation.tipo.id)},get tipo(){return angular.isObject(a.evaluation.tipo)?a.evaluation.tipo.nombre:a.evaluation.tipo}},a.getTipos=function(a){return d.model("evaluaciontipo").search({nombre:a}).then(function(a){return a.data})},a.remove=function(c){d.model("evaluacionpregunta").remove(a.evaluation.preguntas[c].id).then(function(d){a.evaluation.preguntas.splice(c,1),b.success("Se ha eliminado con exito.","Exito")},function(a){b.error("Codigo : "+a.status,"Error")})}}]),angular.module("Evaluationmantenedor").controller("evaluation.admintipoController",["tipos","$scope","apiServices",function(a,b,c){b.tipos=a.data;var d=a.headers("x-pagination-total-count");b.totalItems=parseInt(d),b.currentPage=1,b.pageItems=20,b.setPage=function(a){b.currentPage=a},b.pageChanged=function(a){c.model("evaluaciontipo").page(a).get().then(function(a){b.tipos=a.data})},b.remove=function(a){c.model("evaluaciontipo").remove(b.tipos[a].id).then(function(c){b.tipos.splice(a,1),toastr.success("Se ha eliminado con exito.","Exito")},function(a){toastr.error("Codigo : "+a.status,"Error")})}}]),angular.module("Evaluationmantenedor").controller("evaluation.createtipoController",["$scope","apiServices","$location",function(a,b,c){a.tipo={},a.save=function(){b.model("evaluaciontipo").save(a.tipo).then(function(a){console.log(a),c.path("evaluation/admintipo")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.edittipoController",["$scope","tipo","apiServices","$location",function(a,b,c,d){a.tipo=b.data,a.save=function(){c.model("evaluaciontipo").save(a.tipo).then(function(a){console.log(a),d.path("evaluation/admintipo")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.viewtipoController",["$scope","tipo","apiServices","$location",function(a,b,c,d){a.tipo=b.data,a.remove=function(b){c.model("evaluacionteorica").remove(a.evaluations[b].id).then(function(c){a.evaluations.splice(b,1),toastr.success("Se ha eliminado con exito.","Exito")},function(a){toastr.error("Codigo : "+a.status,"Error")})}}]),angular.module("Evaluationmantenedor").controller("evaluation.editpreguntaController",["toastr","FileUploader","WebApiConfig","$scope","pregunta","apiServices","$location",function(a,b,c,d,e,f,g){d.pregunta=e.data,d.pregunta.eva_id=e.data.eva_id,d.alternativas=e.data.alternativas;e.data.alternativas.length;d.recursos=e.data.recursos,d.sources=e.data.sources,d.files=e.data.rhs;for(var h=0,i=d.files.length;h<i;h++)for(var j=0,k=d.sources.length;j<k;j++)d.sources[j].id==d.files[h].src_id&&(d.files[h].title=d.sources[j].title,d.files[h].src=d.sources[j].src);d.select={habilitado:["SI","NO"],level:["BASICA","MEDIA","AVANZADA"],correcta:["SI","NO"],fuentes:["CONTENIDO","AUDIO-PREGUNTA","POSTER"]},d.addNewChoice=function(){d.alternativas.push({})},d.removeChoice=function(){var a=d.alternativas.length-1;d.alternativas[a].id&&f.model("evaluacionalternativa").remove(d.alternativas[a].id),d.alternativas.splice(a)};var l=d.uploader=new b({headers:{Authorization:"Bearer "+sessionStorage.access_token},url:c.resourceUrl("recursossources"),autoUpload:!0});l.filters.push({name:"syncFilter",fn:function(a,b){return this.queue.length<10}}),l.filters.push({name:"asyncFilter",fn:function(a,b,c){setTimeout(c.resolve,1e3)}}),l.onCompleteItem=function(a,b,c,e){var g={src_id:b.data.id,src:b.data.src,title:b.data.title,tipo:""};g.rec_id=d.recursos.id,f.model("recursoshassources").save(g).then(function(a){var c=a.data;c.src=b.data.src,c.title=b.data.title,d.files.push(c)})},l.onCompleteAll=function(){console.info("onCompleteAll")},d.remove=function(b){f.model("recursoshassources").remove(d.files[b].id).then(function(c){d.files.splice(b,1),a.success("Se ha eliminado con exito.","Exito")},function(b){a.error("Codigo : "+b.status,"Error")})},d.save=function(){f.model("evaluacionpregunta").save(d.pregunta).then(function(b){d.alternativas.forEach(function(a){a.pre_id=b.data.id,f.model("evaluacionalternativa").save(a).then(function(a){console.log(a)})}),f.model("recursos").save(d.recursos).then(function(a){d.files.forEach(function(b){b.rec_id=a.data.id,f.model("recursoshassources").save(b).then(function(a){})})}),d.recursos.pre_id=b.data.id,f.model("recursos").save(d.recursos).then(function(a){}),a.success("Se ha creado la pregunta con éxito.","Exito"),window.history.back()})}}]),angular.module("Evaluationmantenedor").controller("evaluation.createpreguntaController",["FileUploader","WebApiConfig","$scope","$routeParams","apiServices","$location","toastr",function(a,b,c,d,e,f,g){c.pregunta={},c.pregunta.eva_id=d.id;var h=d.id;c.select={habilitado:["SI","NO"],level:["BASICA","MEDIA","AVANZADA"],correcta:["SI","NO"],fuentes:["CONTENIDO","AUDIO-PREGUNTA","POSTER"]},c.alternativas=[],c.recursos={},c.files=[],c.addNewChoice=function(){c.alternativas.push({})},c.removeChoice=function(){var a=c.alternativas.length-1;c.alternativas.splice(a)};var i=c.uploader=new a({headers:{Authorization:"Bearer "+sessionStorage.access_token},url:b.resourceUrl("recursossources"),autoUpload:!0});i.filters.push({name:"syncFilter",fn:function(a,b){return this.queue.length<10}}),i.filters.push({name:"asyncFilter",fn:function(a,b,c){setTimeout(c.resolve,1e3)}}),i.onCompleteItem=function(a,b,d,e){c.files.push({src_id:b.data.id,src:b.data.src,title:b.data.title,tipo:""})},i.onCompleteAll=function(){console.info("onCompleteAll")},c.remove=function(a){c.files.splice(a,1)},c.save=function(){e.model("evaluacionpregunta").save(c.pregunta).then(function(a){c.alternativas.forEach(function(b){b.pre_id=a.data.id,e.model("evaluacionalternativa").save(b).then(function(a){console.log(a)})}),c.recursos.pre_id=a.data.id,console.log(c.files),e.model("recursos").save(c.recursos).then(function(a){c.files.forEach(function(b){b.rec_id=a.data.id,e.model("recursoshassources").save(b).then(function(a){})})}),g.success("Se ha creado la pregunta con éxito.","Exito"),f.path("evaluation/"+h)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.adminclasificacionController",["clasificaciones","$scope","apiServices","toastr",function(a,b,c,d){b.clasificaciones=a.data,console.log(b.clasificaciones);var e=a.headers("x-pagination-total-count");b.totalItems=parseInt(e),b.currentPage=1,b.pageItems=20,b.setPage=function(a){b.currentPage=a},b.pageChanged=function(a){c.model("clasificacion").page(a).get().then(function(a){b.clasificaciones=a.data})},b.remove=function(a){c.model("clasificacion").remove(b.clasificaciones[a].id).then(function(c){b.clasificaciones.splice(a,1),d.success("Se ha eliminado con exito.","Exito")},function(a){d.error("Codigo : "+a.status,"Error")})}}]),angular.module("Evaluationmantenedor").controller("evaluation.createclasificacionController",["$scope","apiServices","$location",function(a,b,c){a.clasificacion={},a.interface={set categoria(b){a.clasificacion.categoria=b,angular.isObject(a.clasificacion.categoria)&&(a.clasificacion.cat_id=a.clasificacion.categoria.id)},get categoria(){return angular.isObject(a.clasificacion.categoria)?a.clasificacion.categoria.nombre:a.clasificacion.categoria}},a.getCategorias=function(a){return b.model("clasificacioncategoria").search({nombre:a}).then(function(a){return a.data})},a.save=function(){b.model("clasificacion").save(a.clasificacion).then(function(a){console.log(a),c.path("evaluation/adminclasificacion")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.editclasificacionController",["$scope","clasificacion","apiServices","$location",function(a,b,c,d){a.clasificacion=b.data,a.interface={set categoria(b){a.clasificacion.categoria=b,angular.isObject(a.clasificacion.categoria)&&(a.clasificacion.cat_id=a.clasificacion.categoria.id)},get categoria(){return angular.isObject(a.clasificacion.categoria)?a.clasificacion.categoria.nombre:a.clasificacion.categoria}},a.getCategorias=function(a){return c.model("clasificacioncategoria").search({nombre:a}).then(function(a){return a.data})},a.save=function(){c.model("clasificacion").save(a.clasificacion).then(function(a){console.log(a),d.path("evaluation/adminclasificacion")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.viewclasificacionController",["$scope","toastr","clasificacion","apiServices","$location",function(a,b,c,d,e){a.clasificacion=c.data}]),angular.module("Evaluationmantenedor").controller("evaluation.adminclasificacionperfilController",["clasificacionperfiles","$scope","apiServices","toastr",function(a,b,c,d){b.clasificacionperfiles=a.data,console.log(b.clasificacionperfiles);var e=a.headers("x-pagination-total-count");b.totalItems=parseInt(e),b.currentPage=1,b.pageItems=20,b.setPage=function(a){b.currentPage=a},b.pageChanged=function(a){c.model("clasificacionperfil").page(a).get().then(function(a){b.clasificacionperfiles=a.data})},b.remove=function(a){c.model("clasificacionperfil").remove(b.clasificacionperfiles[a].id).then(function(c){b.clasificacionperfiles.splice(a,1),d.success("Se ha eliminado con exito.","Exito")},function(a){d.error("Codigo : "+a.status,"Error")})}}]),angular.module("Evaluationmantenedor").controller("evaluation.createclasificacionperfilController",["$scope","apiServices","$location",function(a,b,c){a.clasificacionperfil={},a.interface={set clasificacion(b){a.clasificacionperfil.clasificacion=b,angular.isObject(a.clasificacionperfil.clasificacion)&&(a.clasificacionperfil.cla_id=a.clasificacionperfil.clasificacion.id)},get clasificacion(){return angular.isObject(a.clasificacionperfil.clasificacion)?a.clasificacionperfil.clasificacion.nombre:a.clasificacionperfil.clasificacion},set perfil(b){a.clasificacionperfil.perfil=b,angular.isObject(a.clasificacionperfil.perfil)&&(a.clasificacionperfil.per_id=a.clasificacionperfil.perfil.id)},get perfil(){return angular.isObject(a.clasificacionperfil.perfil)?a.clasificacionperfil.perfil.nombre:a.clasificacionperfil.perfil}},a.getClasificaciones=function(a){return b.model("clasificacion").search({nombre:a}).then(function(a){return a.data})},a.getPerfiles=function(a){return b.model("perfil").search({nombre:a}).then(function(a){return a.data})},a.save=function(){b.model("clasificacionperfil").save(a.clasificacionperfil).then(function(a){console.log(a),c.path("evaluation/adminclasificacionperfil")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.editclasificacionperfilController",["$scope","clasificacionperfil","apiServices","$location",function(a,b,c,d){a.clasificacionperfil=b.data,a.interface={set clasificacion(b){a.clasificacionperfil.clasificacion=b,angular.isObject(a.clasificacionperfil.clasificacion)&&(a.clasificacionperfil.cla_id=a.clasificacionperfil.clasificacion.id)},get clasificacion(){return angular.isObject(a.clasificacionperfil.clasificacion)?a.clasificacionperfil.clasificacion.nombre:a.clasificacionperfil.clasificacion},set perfil(b){a.clasificacionperfil.perfil=b,angular.isObject(a.clasificacionperfil.perfil)&&(a.clasificacionperfil.per_id=a.clasificacionperfil.perfil.id)},get perfil(){return angular.isObject(a.clasificacionperfil.perfil)?a.clasificacionperfil.perfil.nombre:a.clasificacionperfil.perfil}};var e=a.clasificacionperfil.acierto;a.clasificacionperfil.acierto=parseInt(e),a.getClasificaciones=function(a){return c.model("clasificacion").search({nombre:a}).then(function(a){return a.data})},a.getPerfiles=function(a){return c.model("perfil").search({nombre:a}).then(function(a){return a.data})},a.save=function(){c.model("clasificacionperfil").save(a.clasificacionperfil).then(function(a){console.log(a),d.path("evaluation/adminclasificacionperfil")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.viewclasificacionperfilController",["$scope","toastr","clasificacionperfil","apiServices","$location",function(a,b,c,d,e){a.clasificacionperfil=c.data}]),angular.module("Evaluationmantenedor").controller("evaluation.admincategoriaController",["categorias","$scope","apiServices","toastr",function(a,b,c,d){b.categorias=a.data;var e=a.headers("x-pagination-total-count");b.totalItems=parseInt(e),b.currentPage=1,b.pageItems=20,b.setPage=function(a){b.currentPage=a},b.pageChanged=function(a){c.model("clasificacioncategoria").page(a).get().then(function(a){b.categorias=a.data})},b.remove=function(a){c.model("clasificacioncategoria").remove(b.categorias[a].id).then(function(c){b.categorias.splice(a,1),d.success("Se ha eliminado con exito.","Exito")},function(a){d.error("Codigo : "+a.status,"Error")})}}]),angular.module("Evaluationmantenedor").controller("evaluation.createcategoriaController",["$scope","apiServices","$location",function(a,b,c){a.categoria={},a.save=function(){b.model("clasificacioncategoria").save(a.categoria).then(function(a){c.path("evaluation/admincategoria")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.editcategoriaController",["$scope","categoria","apiServices","$location",function(a,b,c,d){a.categoria=b.data,a.save=function(){c.model("clasificacioncategoria").save(a.categoria).then(function(a){console.log(a),d.path("evaluation/admincategoria")},function(a){console.warn(a)})}}]),angular.module("Evaluationmantenedor").controller("evaluation.viewcategoriaController",["$scope","toastr","categoria","apiServices","$location",function(a,b,c,d,e){a.categoria=c.data}]),angular.module("Perfil",["ngAnimate","toastr","ApiRest","ui.bootstrap"]),angular.module("Perfil").controller("perfil.adminperfilController",["perfiles","$scope","apiServices","toastr",function(a,b,c,d){b.perfiles=a.data;var e=a.headers("x-pagination-total-count");b.totalItems=parseInt(e),b.currentPage=1,b.pageItems=20,b.setPage=function(a){b.currentPage=a},b.pageChanged=function(a){c.model("perfil").page(a).get().then(function(a){b.perfiles=a.data})},b.remove=function(a){c.model("perfil").remove(b.perfiles[a].id).then(function(c){b.perfiles.splice(a,1),d.success("Se ha eliminado con exito.","Exito")},function(a){d.error("Codigo : "+a.status,"Error")})}}]),angular.module("Perfil").controller("perfil.createperfilController",["$scope","apiServices","$location","toastr",function(a,b,c,d){a.perfil={},a.clasificaciones=[],a.getClasificaciones=function(a){return b.model("clasificacion").params({nombre:a}).search().then(function(a){return a.data})},a.addNewChoice=function(){a.clasificaciones.push({})},a.removeChoice=function(){var b=a.clasificaciones.length-1;a.clasificaciones.splice(b)},a.save=function(){b.model("perfil").save(a.perfil).then(function(e){a.clasificaciones.forEach(function(a){a.cla_id=a.clasificacion.id,a.per_id=e.data.id,b.model("clasificacionperfil").save(a).then(function(a){console.log(a)})}),c.path("perfil/admin"),d.success("Se ha registrado el perfil con exito.","Exito")},function(a){d.error("Codigo : "+a.status,"Error")})}}]),angular.module("Perfil").controller("perfil.editperfilController",["$scope","perfil","apiServices","$location","toastr",function(a,b,c,d,e){a.perfil=b.data,a.clasificaciones=[],c.model("clasificacionperfil").params({per_id:a.perfil.id}).search().then(function(b){a.clasificaciones=b.data,a.clasificaciones.forEach(function(a){c.model("clasificacion").get(a.cla_id).then(function(b){a.clasificacion=b.data})})}),a.getClasificaciones=function(a){return c.model("clasificacion").params({nombre:a}).search().then(function(a){return a.data})},a.save=function(){c.model("perfil").save(a.perfil).then(function(b){a.clasificaciones.forEach(function(a){a.cla_id=a.clasificacion.id,a.per_id=b.data.id,c.model("clasificacionperfil").save(a).then(function(a){console.log(a)})}),d.path("perfil/admin"),e.success("Se ha registrado el perfil con exito.","Exito")},function(a){e.error("Codigo : "+a.status,"Error")})}}]),angular.module("Perfil").controller("perfil.viewperfilController",["toastr","apiServices","$scope","perfil","$location","$http","reportServices",function(a,b,c,d,e,f,g){console.log(),c.perfil=d.data,c.pdf="",g.init("ot","listado").get(1).then(function(a){console.log(a),c.pdf=a.document.src,a.document.url,a.document.file,a.document.saveAs("hola.pdf"),a.document.open()}),c.remove=function(c){b.model("perfil").remove(c).then(function(b){a.success("Se ha eliminado con exito.","Exito"),e.path("perfil/admin")},function(b){a.error("Codigo : "+b.status,"Error")})}}]);